# Logger组件设计文档

## 通用Logger脚本
### 核心目标
- 捕获目标对象的字段和属性值
- 在Inspector中动态显示捕获的变量，允许用户选择需要打印的变量
- 支持在运行时或编辑器模式中打印选中的变量值，帮助调试目标对象的状态

### 功能模块设计
#### 变量捕获
- 使用反射自动获取目标对象的字段和属性信息
- 提供一个接口`CaptureValues`, 将变量名和值存储到一个字典中
#### 动态显示变量
- 在Inspector中，动态显示从目标对象捕获的变量
- 提供复选框，供用户选择要打印的变量
- 通过自定义编辑器，实时更新选中的变量列表
#### 控制打印
- 提供选择控制打印行为：
    - 运行时自动打印
    - 手动触发打印
- 打印时只输出用户勾选的变量
#### 用户操作流程

- 附加 Logger 组件：
    - 将 Logger 脚本附加到任意 GameObject。
- 设置目标对象：
    - 在 Logger 的 Inspector 面板中设置目标对象（通常是需要调试的脚本）。
- 捕获变量：
    - 点击 “捕获变量” 按钮，Logger 会自动提取目标对象的所有字段和属性，并在 Inspector 中显示。
- 选择变量：
    - 在 Inspector 中勾选需要打印的变量。
- 打印变量：
    - 手动点击 “打印选中的变量” 按钮，或启用 Log On Start 在运行时自动打印。

#### 实现概览
- 核心脚本 `Logger`
    - 实现变量捕获和打印的核心逻辑
    - 动态管理捕获的变量和值
- 自定义编辑器 `LoggerEditor`
    - 提供用户友好的界面

#### 问题
- 局部变量捕获：
   - 增加一个接口，允许开发者手动注册局部变量或动态状态，并通过 LoggerManager 输出。
- 异步日志输出：
   - 将日志输出（特别是文件写入或网络发送）放到异步线程中，避免阻塞主线程。
   - 使用日志队列或缓冲区提高性能。
- 复杂对象支持：
   - 增加递归解析逻辑，支持打印复杂对象（如嵌套类型、集合）。
   - 提供选项，让用户选择是否深度解析复杂对象。


- [x] 问题：
    - 目前只能打印一个变量，如果多选，只会打印列表中第一个变量
    - 并且这个变量只能在选择后，通过`Log Selected Variables`按钮打印
    - 能不能将所有选择的变量，以分组的形式统一打印出来？
    - 能不能在按下`Refresh Variables`按钮后，根据变量的作用域，将它们分组？
- [x] 改进：
    - 打印的输出格式，分组部分也应该有自己的命名
    - 能不能增加dropdown，`Target Component`， 拖入的`Component`的子组件？
- [ ] 改进：
    - 默认不显示Unity自带的那些那些属性，比如`position`, `gameObject`等（`Properties` 默认为"collapsed"）
    - `logger`的主要目的是为了查看自定义的字段和属性，现在这些不能全部显示（private field）

### **基于事件触发的 Logger 功能设计总结**

---

### **核心目标**
通过事件机制使日志功能更加灵活，可动态触发日志记录，适应多种场景需求。特别是在复杂系统（如网格游戏）中，当特定行为（如对象移动、攻击等）发生时，自动触发日志记录，并可绑定额外的逻辑。

---

#### **1. Logger 核心扩展**
- **事件机制**：
  - 引入 `UnityEvent` 字段 `onLogEvent`，允许用户在 `Inspector` 中动态绑定需要在日志触发时执行的功能。
  - 提供 `TriggerLogEvent` 方法，用于外部调用触发日志记录，同时触发事件。
  
- **日志捕获与触发**：
  - 每次调用日志记录方法时：
    1. 自动捕获并打印目标对象信息。
    2. 触发 `onLogEvent`，执行绑定的额外逻辑。

---

#### **2. 场景中使用示例**
以网格游戏（Grid Game）为例：

##### **Tile 对象的事件触发**
1. 每个 Tile 上附加 `Logger` 脚本。
2. 在 Tile 移动时：
   - 调用 `Logger.TriggerLogEvent()`。
   - 自动记录 Tile 的新位置、旋转等信息，并在 Console 中打印。
   - 同时触发 `onLogEvent`，执行绑定的其他功能（如更新 UI、触发音效等）。

##### **动态绑定的灵活性**
- 在 `Inspector` 中，用户可以为 `onLogEvent` 动态绑定：
  - **打印额外信息**：显示更多的调试内容。
  - **调用其他模块逻辑**：如更新界面或触发其他系统行为。
  - **记录到外部文件或网络**：将日志数据发送到文件或远程服务器。

---

### **功能优点**
1. **事件驱动的灵活性**：
   - 通过 `UnityEvent`，日志触发逻辑完全解耦，可动态绑定多个功能，适用于多种场景。

2. **简化复杂逻辑**：
   - `Logger` 的事件触发可以将日志功能与其他系统（如音效、UI）结合，简化开发流程。

3. **动态适配多场景**：
   - 无需修改代码，只需在 `Inspector` 中调整 `onLogEvent` 的绑定，即可适配新的需求。

4. **易于扩展**：
   - 可以轻松为 `Logger` 添加额外的触发条件（如特定时间、状态变化等），进一步扩展其适用范围。

---

### **适用场景**
1. **网格游戏（Grid Game）**：
   - 记录和调试 Tile 的移动、旋转等行为，适合路径规划、AI 调试。
2. **玩家行为日志**：
   - 触发特定事件时记录玩家状态（如血量、位置、动作）。
3. **敌人状态监控**：
   - 记录敌人的状态切换（如巡逻、追踪、攻击），用于 AI 行为分析。
4. **网络消息调试**：
   - 在发送或接收消息时触发日志记录，并通过 `onLogEvent` 发送到远程服务器。

---

### **扩展方向**
1. **高级触发条件**：
   - 增加对复杂条件的支持（如特定状态、时间或自定义逻辑）。

2. **多目标绑定**：
   - 支持多个目标对象的日志捕获，通过事件动态切换目标。

3. **持久化日志**：
   - 将日志写入文件或发送到远程服务器，用于长期监控。

4. **UI 集成**：
   - 将事件触发的日志信息同步到游戏界面，供玩家或开发者实时查看。

---

通过基于事件的日志触发机制，不仅提升了 `Logger` 的灵活性和适用性，还为多模块协作提供了便捷的接口，使其能够适应各种复杂的游戏开发场景。



## Logger Manager设计目标
- 集中管理：将场景中所有附着 Logger 的组件集中到一个 LoggerManager 中进行统一管理。
- 灵活配置：通过配置文件或 Inspector 定义每个 Logger 的优先级、输出格式和发送顺序。
- 格式化日志输出：统一定义日志的输出格式（如 JSON、表格格式等），方便阅读和存储。
- 分发机制：控制日志的发送方式，例如打印到 Console、存储到文件、或通过网络发送到远程服务器。

#### 拓展
- 日志分组：
    - 按类别或模块分组日志，例如“玩家状态日志”“网络日志”等。

- 实时控制：
    - 提供一个运行时 UI，让用户动态启用/禁用日志，调整优先级等。

- 格式灵活性：
    - 提供多种预定义格式（JSON、纯文本等），通过配置切换格式。

- 多线程日志：
    - 对于频繁日志输出的场景，使用线程安全的队列处理日志，避免主线程卡顿。

- 性能优化：
    - 限制日志输出频率，例如设置日志刷新间隔时间（如每秒一次）。
    
## LogSender
- 接收LoggerManager发送的日志，并进行处理
- 日志可视化工具：
   - 提供一个可视化的日志分析工具（如 Unity 的 Editor 扩展窗口），让开发者可以直接在 Editor 中筛选和分析日志。